<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>App.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gremlins_scaffold</a> &gt; <a href="index.source.html" class="el_package">gremlins</a> &gt; <span class="el_source">App.java</span></div><h1>App.java</h1><pre class="source lang-java linenums">package gremlins;

import processing.core.PApplet;
import processing.core.PImage;
import processing.data.JSONObject;
import processing.data.JSONArray;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.Random;
import java.util.Scanner;
import gremlins.Engine;

import java.io.*;

import java.io.File;
import java.io.FileNotFoundException;


public class App extends PApplet {

    public static final int WIDTH = 720;
    public static final int HEIGHT = 720;
    public static final int SPRITESIZE = 20;
    public static final int BOTTOMBAR = 60;

    public static final int FPS = 60;

    public int numLevels;

<span class="fc" id="L31">    public static final Random randomGenerator = new Random();</span>

    public String configPath;

    public int currentLevel;
    
    public BrickWall brickwall;
    public StoneWall stonewall;
    public Life lifePowerup;

    public Player player;

<span class="fc" id="L43">    public boolean isWon = true;</span>
    public int gameActiveState;

<span class="fc" id="L46">    public char[][] map = new char[37][37];</span>

<span class="fc" id="L48">    public ArrayList&lt;Fireball&gt; activeFireballs = new ArrayList&lt;Fireball&gt;();</span>
<span class="fc" id="L49">    public ArrayList&lt;Gremlin&gt; activeGremlins = new ArrayList&lt;Gremlin&gt;();</span>
<span class="fc" id="L50">    public ArrayList&lt;Wall&gt; activeWalls = new ArrayList&lt;Wall&gt;();</span>

<span class="fc" id="L52">    public ArrayList&lt;StoneWall&gt; activeStoneWalls = new ArrayList&lt;StoneWall&gt;();</span>
<span class="fc" id="L53">    public ArrayList&lt;BrickWall&gt; activeBrickWalls = new ArrayList&lt;BrickWall&gt;();</span>
<span class="fc" id="L54">    public ArrayList&lt;Ground&gt; groundTiles = new ArrayList&lt;Ground&gt;();</span>
<span class="fc" id="L55">    public ArrayList&lt;Slime&gt; activeSlimes = new ArrayList&lt;Slime&gt;();</span>

    public EscapeDoor escapeDoor;

<span class="fc" id="L59">    public App() {</span>
<span class="fc" id="L60">        this.configPath = &quot;config.json&quot;;</span>
<span class="fc" id="L61">    }</span>

    /**
     * Initialise the setting of the window size.
    */
    public void settings() {
<span class="nc" id="L67">        size(WIDTH, HEIGHT);</span>
<span class="nc" id="L68">    }</span>

    /**
     * Load all resources such as images. Initialise the elements such as the player, enemies and map elements.
    */
    public void setup() {
<span class="nc" id="L74">        frameRate(FPS);</span>
<span class="nc" id="L75">        this.gameActiveState = 0; </span>

        try {
<span class="nc" id="L78">            JSONObject conf = loadJSONObject(new File(this.configPath));</span>
<span class="nc" id="L79">            JSONArray newObj = conf.getJSONArray(&quot;levels&quot;);</span>
            
<span class="nc" id="L81">            this.numLevels = newObj.size();</span>
<span class="nc" id="L82">        } catch (Exception e) {</span>
<span class="nc" id="L83">            System.out.println(&quot;Error loading game. Please check configuration&quot;);</span>
<span class="nc" id="L84">        }</span>

<span class="nc" id="L86">        this.currentLevel = 1;</span>
<span class="nc" id="L87">        initializeLevel(this.currentLevel, 3);</span>
        
<span class="nc" id="L89">        drawMap();</span>
<span class="nc" id="L90">    }</span>

    public void initializeLevel(int levelNum, int numLives) {
<span class="nc" id="L93">        String levelFileName = String.format(&quot;level%d.txt&quot;, levelNum);</span>
        
<span class="nc" id="L95">        activeFireballs = new ArrayList&lt;Fireball&gt;();</span>
<span class="nc" id="L96">        activeGremlins = new ArrayList&lt;Gremlin&gt;();</span>
<span class="nc" id="L97">        activeWalls = new ArrayList&lt;Wall&gt;();</span>

<span class="nc" id="L99">        activeStoneWalls = new ArrayList&lt;StoneWall&gt;();</span>
<span class="nc" id="L100">        activeBrickWalls = new ArrayList&lt;BrickWall&gt;();</span>
<span class="nc" id="L101">        groundTiles = new ArrayList&lt;Ground&gt;();</span>
<span class="nc" id="L102">        activeSlimes = new ArrayList&lt;Slime&gt;();</span>

<span class="nc" id="L104">        lifePowerup = new Life(this, 0, 0);</span>
        
        try {
<span class="nc" id="L107">            File levelData = new File(levelFileName);</span>
<span class="nc" id="L108">            Scanner levelScanner = new Scanner(levelData).useDelimiter(&quot;\n&quot;);</span>

<span class="nc" id="L110">            map = new char[37][37];</span>

<span class="nc" id="L112">            int rowCount = 0;</span>
<span class="nc" id="L113">            int colCount = 0;</span>

<span class="nc bnc" id="L115" title="All 2 branches missed.">            while (levelScanner.hasNext()) {</span>
<span class="nc" id="L116">                String tileRow = levelScanner.next();</span>
<span class="nc" id="L117">                int tileRowCount = 0;</span>
<span class="nc" id="L118">                System.out.println(tileRow);</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">                while (tileRowCount &lt; tileRow.length()) {</span>
<span class="nc" id="L120">                    char tile = tileRow.charAt(tileRowCount);</span>
                    // System.out.printf(&quot;Row Count: %d, Col Count: %d, Character: %c\n&quot;, rowCount, colCount, tile);
<span class="nc bnc" id="L122" title="All 2 branches missed.">                    if (colCount &gt; 36) {</span>
<span class="nc" id="L123">                        colCount = 0;</span>
<span class="nc" id="L124">                        rowCount++;</span>
                    }

<span class="nc bnc" id="L127" title="All 2 branches missed.">                    if (tile == 'W') {</span>
<span class="nc" id="L128">                        float x = colCount * 20;</span>
<span class="nc" id="L129">                        float y = rowCount * 20;</span>

<span class="nc" id="L131">                        this.player = new Player(this, colCount * 20, rowCount * 20, numLives);</span>
                        // this.player.moveTo(this, colCount * 20, rowCount * 20);
<span class="nc bnc" id="L133" title="All 2 branches missed.">                    } else if (tile == 'G') {</span>
<span class="nc" id="L134">                        Gremlin gremlin = new Gremlin(this);</span>

<span class="nc" id="L136">                        gremlin.posX = colCount * 20;</span>
<span class="nc" id="L137">                        gremlin.posY = rowCount * 20;</span>

<span class="nc" id="L139">                        gremlin.moveTo(this, colCount * 20, rowCount * 20);</span>
            
<span class="nc" id="L141">                        boolean[] collidingWalls = Engine.checkWallCollisions(gremlin, activeStoneWalls, activeBrickWalls);</span>
<span class="nc" id="L142">                        int newGremlinHeading = (int)Math.floor(Math.random() * (3 + 1));</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">                        while (collidingWalls[newGremlinHeading] == true) {</span>
<span class="nc" id="L144">                            newGremlinHeading = (int)Math.floor(Math.random() * (3 + 1)); </span>
                        }
                        
<span class="nc" id="L147">                        gremlin.changeHeading(newGremlinHeading);</span>

<span class="nc" id="L149">                        activeGremlins.add(gremlin);</span>
                    }

<span class="nc" id="L152">                    map[rowCount][colCount] = tile;</span>
<span class="nc" id="L153">                    tileRowCount++;</span>
<span class="nc" id="L154">                    colCount++; </span>
<span class="nc" id="L155">                }</span>

<span class="nc" id="L157">            }</span>

<span class="nc" id="L159">            levelScanner.close();</span>
<span class="nc" id="L160">        } catch (FileNotFoundException e) {</span>
<span class="nc" id="L161">            System.out.printf(&quot;%s doesn't exist\n&quot;, levelFileName);</span>
<span class="nc" id="L162">        }</span>
<span class="nc" id="L163">    }</span>

    public void loadNextLevel() {
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (this.currentLevel == this.numLevels) {</span>
<span class="nc" id="L167">            this.gameActiveState = 1;</span>
        } else {
<span class="nc" id="L169">            this.currentLevel += 1;</span>
<span class="nc" id="L170">            System.out.println(this.currentLevel);</span>
<span class="nc" id="L171">            initializeLevel(this.currentLevel, this.player.health.numLives);</span>
<span class="nc" id="L172">            drawMap();     </span>
        }
<span class="nc" id="L174">    }</span>
    /**
     * Receive key pressed signal from the keyboard.
    */
    public void keyPressed(){
<span class="nc bnc" id="L179" title="All 2 branches missed.">        if (this.keyCode == 37) {</span>
<span class="nc" id="L180">            this.player.moveLeft(this);</span>
        }

<span class="nc bnc" id="L183" title="All 2 branches missed.">        if (this.keyCode == 38) {</span>
<span class="nc" id="L184">            this.player.moveUp(this);</span>
        } 

<span class="nc bnc" id="L187" title="All 2 branches missed.">        if (this.keyCode == 39) {</span>
<span class="nc" id="L188">            this.player.moveRight(this);</span>
        }

<span class="nc bnc" id="L191" title="All 2 branches missed.">        if (this.keyCode == 40) {</span>
<span class="nc" id="L192">            this.player.moveDown(this);</span>
        } 

<span class="nc bnc" id="L195" title="All 2 branches missed.">        if (this.keyCode == 32) {</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            if (this.player.directionFacing.equals(&quot;Right&quot;)) {</span>
<span class="nc" id="L197">                Fireball newFireball = new Fireball(this, this.player.posX, this.player.posY, 4, 0, 1);</span>
<span class="nc" id="L198">                activeFireballs.add(newFireball);</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            } else if (this.player.directionFacing.equals(&quot;Left&quot;)) {</span>
<span class="nc" id="L200">                Fireball newFireball = new Fireball(this, this.player.posX, this.player.posY, -4, 0, 0);</span>
<span class="nc" id="L201">                activeFireballs.add(newFireball);</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">            } else if (this.player.directionFacing.equals(&quot;Up&quot;)) {</span>
<span class="nc" id="L203">                Fireball newFireball = new Fireball(this, this.player.posX, this.player.posY, 0, -4, 2);</span>
<span class="nc" id="L204">                activeFireballs.add(newFireball);</span>
<span class="nc" id="L205">            } else {</span>
<span class="nc" id="L206">                Fireball newFireball = new Fireball(this, this.player.posX, this.player.posY, 0, 4, 3);</span>
<span class="nc" id="L207">                activeFireballs.add(newFireball);</span>
            }
        }
<span class="nc" id="L210">    }</span>
    
    /**
     * Receive key released signal from the keyboard.
    */
    public void keyReleased(){
<span class="nc" id="L216">        this.player.velocityX = 0;</span>
<span class="nc" id="L217">        this.player.velocityY = 0;</span>
<span class="nc" id="L218">    }</span>

    public void drawMap() {
<span class="nc" id="L221">        int rowCount = 0;</span>

<span class="nc bnc" id="L223" title="All 2 branches missed.">        while(rowCount &lt; map.length) {</span>
<span class="nc" id="L224">            int colCount = 0;</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">            while (colCount &lt; map[1].length) {</span>
               
<span class="nc" id="L227">                char brick = 'B';</span>
<span class="nc" id="L228">                char stone = 'X';</span>
<span class="nc" id="L229">                char player = 'W';</span>


<span class="nc bnc" id="L232" title="All 2 branches missed.">                if (map[rowCount][colCount] == brick) {</span>
<span class="nc" id="L233">                    BrickWall brickwall = new BrickWall(this, colCount*20, rowCount*20);</span>
<span class="nc" id="L234">                    activeWalls.add(brickwall);</span>
<span class="nc" id="L235">                    activeBrickWalls.add(brickwall);</span>
                }

<span class="nc bnc" id="L238" title="All 2 branches missed.">                if (map[rowCount][colCount] == stone) {</span>
<span class="nc" id="L239">                    StoneWall stonewall = new StoneWall(this, colCount*20, rowCount*20);</span>
<span class="nc" id="L240">                    activeStoneWalls.add(stonewall);</span>
<span class="nc" id="L241">                    activeWalls.add(stonewall);</span>
                }

<span class="nc bnc" id="L244" title="All 2 branches missed.">                if (map[rowCount][colCount] == ' ') {</span>
<span class="nc" id="L245">                    Ground groundtile = new Ground(this, colCount * 20, rowCount * 20);</span>
<span class="nc" id="L246">                    groundTiles.add(groundtile);</span>
                }

<span class="nc bnc" id="L249" title="All 2 branches missed.">                if (map[rowCount][colCount] == 'E') {</span>
<span class="nc" id="L250">                    escapeDoor = new EscapeDoor(this, colCount * 20, rowCount * 20);</span>
                }

<span class="nc" id="L253">                colCount++;</span>
<span class="nc" id="L254">            }</span>

<span class="nc" id="L256">            rowCount++;</span>
<span class="nc" id="L257">        }</span>
<span class="nc" id="L258">    }</span>

    /**
     * Draw all elements in the game by current frame. 
	 */
    public void draw() {
<span class="nc" id="L264">        background(169, 149, 123);</span>

<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (this.gameActiveState == 0) {</span>

<span class="nc bnc" id="L268" title="All 2 branches missed.">            if (this.player.health.numLives == 0) {</span>
<span class="nc" id="L269">                this.gameActiveState = 2;</span>
            }

<span class="nc" id="L272">            Engine.handleLifePowerUpSpawn(player, lifePowerup, groundTiles);</span>
<span class="nc" id="L273">            Engine.checkPlayerGainsLife(player, lifePowerup);</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">            if (lifePowerup.isActive == true) {</span>
<span class="nc" id="L275">                lifePowerup.draw();</span>
            }

<span class="nc" id="L278">            boolean isAtExit = Engine.checkPlayerAtExit(player, escapeDoor);</span>
<span class="nc" id="L279">            activeSlimes = Engine.monitorGremlinSpawns(player, activeGremlins, groundTiles, activeSlimes);</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">            if (isAtExit == true) {</span>
<span class="nc" id="L281">                loadNextLevel();</span>
            }

<span class="nc" id="L284">            Iterator&lt;BrickWall&gt; brickwallItr = this.activeBrickWalls.iterator();</span>

<span class="nc bnc" id="L286" title="All 2 branches missed.">            while (brickwallItr.hasNext()) {</span>
<span class="nc" id="L287">                BrickWall brickwall = brickwallItr.next();</span>

<span class="nc" id="L289">                boolean isDestroyed = brickwall.tick();</span>
                    
<span class="nc bnc" id="L291" title="All 2 branches missed.">                if (isDestroyed == true) {</span>

<span class="nc" id="L293">                    brickwallItr.remove();</span>
                }
  
<span class="nc" id="L296">            }</span>

<span class="nc" id="L298">            escapeDoor.draw();</span>
<span class="nc" id="L299">            boolean[] playerWallCollisions = Engine.checkWallCollisions(player, activeStoneWalls, activeBrickWalls);</span>
              
<span class="nc" id="L301">            Object[] playerGremlinCollisionInfo = Engine.checkPlayerGremlinCollision(player, activeGremlins);</span>
<span class="nc" id="L302">            boolean isPlayerHit = (boolean)playerGremlinCollisionInfo[1];</span>
    
<span class="nc" id="L304">            activeGremlins = (ArrayList&lt;Gremlin&gt;)playerGremlinCollisionInfo[0];</span>
    
<span class="nc bnc" id="L306" title="All 4 branches missed.">            if ((this.player.directionFacing == &quot;Left&quot;) &amp;&amp; (playerWallCollisions[0] == false)) {</span>
<span class="nc" id="L307">                this.player.move();</span>
<span class="nc bnc" id="L308" title="All 4 branches missed.">            } else if ((this.player.directionFacing == &quot;Right&quot;) &amp;&amp; (playerWallCollisions[1] == false)) {</span>
<span class="nc" id="L309">                this.player.move();</span>
<span class="nc bnc" id="L310" title="All 4 branches missed.">            } else if ((this.player.directionFacing == &quot;Up&quot;) &amp;&amp; (playerWallCollisions[2] == false)) {</span>
<span class="nc" id="L311">                this.player.move();</span>
<span class="nc bnc" id="L312" title="All 4 branches missed.">            } else if ((this.player.directionFacing == &quot;Down&quot;) &amp;&amp; (playerWallCollisions[3] == false)) {</span>
<span class="nc" id="L313">                this.player.move();</span>
            }
    
<span class="nc" id="L316">            this.player.draw(this);</span>
    
<span class="nc" id="L318">            Iterator&lt;Fireball&gt; fireballItr = activeFireballs.iterator();</span>
            
<span class="nc bnc" id="L320" title="All 2 branches missed.">            while (fireballItr.hasNext()) {</span>
<span class="nc" id="L321">                Fireball fireball = fireballItr.next();</span>
    
<span class="nc" id="L323">                activeBrickWalls = Engine.renderBrickWalls(fireball, activeBrickWalls);</span>
<span class="nc" id="L324">                Object[] fireballGremlinCollisionData = Engine.checkFireballGremlinCollision(fireball, activeGremlins);</span>
<span class="nc" id="L325">                activeGremlins = (ArrayList&lt;Gremlin&gt;)fireballGremlinCollisionData[0];</span>
<span class="nc" id="L326">                boolean isFireballDestroyed = (Engine.handleFireball(fireball, activeStoneWalls, activeBrickWalls));</span>
                
<span class="nc bnc" id="L328" title="All 2 branches missed.">                if (isFireballDestroyed == false) {</span>
<span class="nc" id="L329">                    fireball.move(this);    </span>
                } else {
<span class="nc" id="L331">                    fireballItr.remove();      </span>
                }   
<span class="nc" id="L333">            }</span>
    
<span class="nc bnc" id="L335" title="All 2 branches missed.">            for (Gremlin gremlin: activeGremlins) {</span>
<span class="nc" id="L336">                boolean[] collidingWalls = Engine.checkWallCollisions(gremlin, activeStoneWalls, activeBrickWalls);</span>
<span class="nc" id="L337">                int currentGremlinHeading = gremlin.headingDirection;</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">                if (gremlin.isAlive == true) {</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">                    if ((collidingWalls[currentGremlinHeading] == true)) {</span>
<span class="nc" id="L340">                        int newGremlinHeading = (int)Math.floor(Math.random() * (3 + 1));</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">                        while (collidingWalls[newGremlinHeading] == true) {</span>
<span class="nc" id="L342">                            newGremlinHeading = (int)Math.floor(Math.random() * (3 + 1)); </span>
                        }
        
<span class="nc" id="L345">                        gremlin.changeHeading(newGremlinHeading);</span>
<span class="nc" id="L346">                        gremlin.move();</span>
<span class="nc" id="L347">                        gremlin.draw(this);</span>
<span class="nc" id="L348">                    } else {</span>
<span class="nc" id="L349">                        gremlin.move();</span>
<span class="nc" id="L350">                        gremlin.draw(this);</span>
                    }  
                }
<span class="nc" id="L353">            }</span>
    
<span class="nc" id="L355">            Iterator&lt;Slime&gt; slimeItr = activeSlimes.iterator();</span>
    
            
<span class="nc bnc" id="L358" title="All 2 branches missed.">            while (slimeItr.hasNext()) {</span>
<span class="nc" id="L359">                Slime slime = slimeItr.next();</span>
    
<span class="nc" id="L361">                boolean isSlimeDestroyed = (Engine.handleSlime(slime, activeStoneWalls, activeBrickWalls));</span>
<span class="nc" id="L362">                Object[] playerSlimeCollisionData = Engine.checkSlimePlayerCollision(this.player, activeSlimes);</span>
<span class="nc" id="L363">                activeSlimes = (ArrayList&lt;Slime&gt;)playerSlimeCollisionData[0];</span>
                
<span class="nc bnc" id="L365" title="All 2 branches missed.">                if (isSlimeDestroyed == false) {</span>
<span class="nc" id="L366">                    slime.move();  </span>
<span class="nc" id="L367">                    slime.draw(this);  </span>
                } else {
<span class="nc" id="L369">                    slimeItr.remove();      </span>
                }   
<span class="nc" id="L371">            }</span>

<span class="nc bnc" id="L373" title="All 2 branches missed.">            for (StoneWall stonewall: activeStoneWalls) {</span>
<span class="nc" id="L374">                stonewall.draw(this);</span>
<span class="nc" id="L375">            }</span>

            
<span class="nc bnc" id="L378" title="All 2 branches missed.">            for (BrickWall brickwall: activeBrickWalls) {</span>
<span class="nc" id="L379">                brickwall.draw(this);</span>
<span class="nc" id="L380">            }</span>

<span class="nc" id="L382">            this.player.health.bar();</span>
<span class="nc" id="L383">            textSize(20);</span>
<span class="nc" id="L384">            text(&quot;Lives: &quot;, 20, 695); </span>
    
<span class="nc" id="L386">            String levelDisplay = String.format(&quot;Level: %d/%d&quot;, this.currentLevel, this.numLevels);</span>
<span class="nc" id="L387">            text(levelDisplay, 300, 695); </span>

<span class="nc bnc" id="L389" title="All 2 branches missed.">        } else if (this.gameActiveState == 1) {</span>
<span class="nc" id="L390">            textSize(30);</span>
<span class="nc" id="L391">            text(&quot;You Won!!!&quot;, 280, 360);     </span>
        } else {
<span class="nc" id="L393">            textSize(30);</span>
<span class="nc" id="L394">            text(&quot;Game Over!!!&quot;, 280, 360);    </span>
        }
<span class="nc" id="L396">    }</span>

    public static void main(String[] args) {
<span class="nc" id="L399">        PApplet.main(&quot;gremlins.App&quot;);</span>
<span class="nc" id="L400">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>